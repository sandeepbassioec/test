{"version":3,"file":"a11y.js","sourceRoot":"","sources":["../../src/internal/a11y.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n *\r\n * ******************************************************************\r\n * Utility for managing focus trapping within OUI components.\r\n * This allows components like ODrawer, ODialogs, etc. to trap focus\r\n * within their boundaries for improved accessibility.\r\n * ******************************************************************\r\n *\r\n */\r\n\r\nexport interface FocusTrapOptions {\r\n\t/** The root element of the component where focus will be trapped */\r\n\trootElement: HTMLElement;\r\n\t/** The selector for additional focusable elements */\r\n\tfocusableSelector?: string;\r\n\t/** Whether to initially focus the first element when trap is activated */\r\n\tautoFocus?: boolean;\r\n}\r\n\r\n// Define default focusable selector\r\nconst DEFAULT_FOCUSABLE_SELECTOR =\r\n\t'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"]), o-button:not([disabled]), o-icon-button:not([disabled])';\r\n\r\nexport class FocusTrap {\r\n\tprivate focusableElements: HTMLElement[] = [];\r\n\tprivate isActive: boolean = false;\r\n\tprivate resizeObserver: ResizeObserver | null = null;\r\n\tprivate mutationObserver: MutationObserver | null = null;\r\n\r\n\tconstructor(\r\n\t\tprivate rootElement: HTMLElement,\r\n\t\tprivate focusableSelector: string = DEFAULT_FOCUSABLE_SELECTOR,\r\n\t\tprivate autoFocus: boolean = false\r\n\t) {\r\n\t\tthis.handleKeyDown = this.handleKeyDown.bind(this);\r\n\t\tthis.collectFocusableElements = this.collectFocusableElements.bind(this);\r\n\t\tthis.isVisible = this.isVisible.bind(this);\r\n\r\n\t\tif (focusableSelector) {\r\n\t\t\tthis.focusableSelector = `${DEFAULT_FOCUSABLE_SELECTOR}, ${focusableSelector}`;\r\n\t\t} else {\r\n\t\t\tthis.focusableSelector = DEFAULT_FOCUSABLE_SELECTOR;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Activates the focus trap\r\n\t */\r\n\tpublic activate(): void {\r\n\t\tif (this.isActive) return;\r\n\t\tthis.isActive = true;\r\n\t\tdocument.addEventListener('keydown', this.handleKeyDown);\r\n\t\tthis.collectFocusableElements();\r\n\t\tthis.setupObservers();\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.collectFocusableElements();\r\n\r\n\t\t\tif (this.autoFocus) {\r\n\t\t\t\tif (this.focusableElements.length) {\r\n\t\t\t\t\tthis.focusableElements[0].focus();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Focus the root element if autoFocus is false\r\n\t\t\t\tthis.rootElement.focus();\r\n\t\t\t}\r\n\t\t}, 150);\r\n\t}\r\n\r\n\t/**\r\n\t * Deactivates the focus trap\r\n\t */\r\n\tpublic deactivate(): void {\r\n\t\tif (!this.isActive) return;\r\n\t\tthis.isActive = false;\r\n\t\tdocument.removeEventListener('keydown', this.handleKeyDown);\r\n\t\tthis.cleanupObservers();\r\n\t\tthis.focusableElements = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Set up observers to track DOM changes\r\n\t */\r\n\tprivate setupObservers(): void {\r\n\t\tthis.mutationObserver = new MutationObserver(() => this.isActive && this.collectFocusableElements());\r\n\t\tthis.resizeObserver = new ResizeObserver(() => this.isActive && this.collectFocusableElements());\r\n\r\n\t\tif (this.rootElement) {\r\n\t\t\tthis.mutationObserver.observe(this.rootElement, {\r\n\t\t\t\tchildList: true,\r\n\t\t\t\tsubtree: true,\r\n\t\t\t\tattributes: true,\r\n\t\t\t\tattributeFilter: ['disabled', 'tabindex', 'hidden', 'style']\r\n\t\t\t});\r\n\t\t\tthis.resizeObserver.observe(this.rootElement);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clean up observers\r\n\t */\r\n\tprivate cleanupObservers(): void {\r\n\t\tthis.mutationObserver?.disconnect();\r\n\t\tthis.mutationObserver = null;\r\n\t\tthis.resizeObserver?.disconnect();\r\n\t\tthis.resizeObserver = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the list of focusable elements\r\n\t * @param slot Optional slot that changed, to only process specific elements\r\n\t */\r\n\tpublic update(slot?: HTMLSlotElement): void {\r\n\t\tif (this.isActive) {\r\n\t\t\tslot ? this.addFocusableElements(slot.assignedElements({ flatten: true })) : this.collectFocusableElements();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Collects all focusable elements within the component\r\n\t */\r\n\tprivate collectFocusableElements(): void {\r\n\t\tthis.focusableElements = [];\r\n\t\tif (!this.rootElement) return;\r\n\t\ttry {\r\n\t\t\tconst query = (selector: string, root: Element): HTMLElement[] =>\r\n\t\t\t\tArray.from(root.querySelectorAll(selector)).filter(this.isVisible) as HTMLElement[];\r\n\r\n\t\t\t// Check if the root element itself is focusable\r\n\t\t\tif (this.rootElement.matches('[tabindex]:not([tabindex=\"-1\"])') && this.isVisible(this.rootElement)) {\r\n\t\t\t\tthis.focusableElements.push(this.rootElement);\r\n\t\t\t}\r\n\r\n\t\t\tthis.focusableElements.push(...query(this.focusableSelector, this.rootElement));\r\n\r\n\t\t\tthis.rootElement.querySelectorAll('slot').forEach((slot) => {\r\n\t\t\t\tslot.assignedElements({ flatten: true }).forEach((el) => {\r\n\t\t\t\t\tif (el instanceof HTMLElement) {\r\n\t\t\t\t\t\tif (el.matches(this.focusableSelector) && this.isVisible(el)) {\r\n\t\t\t\t\t\t\tthis.focusableElements.push(el);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (el.querySelectorAll) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tthis.focusableElements.push(...query(this.focusableSelector, el));\r\n\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\tconsole.error('Error querying nested focusable elements:', err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Remove duplicates and sort\r\n\t\t\tthis.focusableElements = Array.from(new Set(this.focusableElements));\r\n\t\t\tthis.sortFocusableElements();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Error in collectFocusableElements:', err);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sort focusable elements by tabindex\r\n\t */\r\n\tprivate sortFocusableElements(): void {\r\n\t\tthis.focusableElements.sort((a, b) => {\r\n\t\t\tconst aTabIndex = a.tabIndex;\r\n\t\t\tconst bTabIndex = b.tabIndex;\r\n\t\t\treturn aTabIndex > 0 && bTabIndex > 0 ? aTabIndex - bTabIndex : aTabIndex > 0 ? -1 : bTabIndex > 0 ? 1 : 0;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Check if an element is visible\r\n\t */\r\n\tprivate isVisible(element: HTMLElement): boolean {\r\n\t\tif (!element) return false;\r\n\t\ttry {\r\n\t\t\tconst { visibility, display } = window.getComputedStyle(element);\r\n\t\t\treturn (\r\n\t\t\t\t(element.offsetWidth > 0 || element.offsetHeight > 0 || element.getClientRects().length > 0) &&\r\n\t\t\t\tvisibility !== 'hidden' &&\r\n\t\t\t\tdisplay !== 'none'\r\n\t\t\t);\r\n\t\t} catch (_err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method to add focusable elements from a node list\r\n\t */\r\n\tprivate addFocusableElements(elements: Element[]): void {\r\n\t\ttry {\r\n\t\t\tconst newElements: HTMLElement[] = [];\r\n\t\t\telements.forEach((element) => {\r\n\t\t\t\tif (element instanceof HTMLElement) {\r\n\t\t\t\t\tif (element.matches(this.focusableSelector) && this.isVisible(element)) {\r\n\t\t\t\t\t\tnewElements.push(element);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (element.querySelectorAll) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst childFocusable = Array.from(element.querySelectorAll(this.focusableSelector)).filter(\r\n\t\t\t\t\t\t\t\tthis.isVisible\r\n\t\t\t\t\t\t\t) as HTMLElement[];\r\n\t\t\t\t\t\t\tnewElements.push(...childFocusable);\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tconsole.error('Error querying child focusable elements:', err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.focusableElements = Array.from(new Set([...this.focusableElements, ...newElements]));\r\n\t\t\tthis.sortFocusableElements();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Error in addFocusableElements:', err);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles Tab key events to trap focus\r\n\t */\r\n\tprivate handleKeyDown(event: KeyboardEvent): void {\r\n\t\tif (!this.isActive || event.key !== 'Tab') return;\r\n\t\tthis.collectFocusableElements();\r\n\t\tif (this.focusableElements.length < 2) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst [firstElement, lastElement] = [this.focusableElements[0], this.focusableElements.at(-1)!];\r\n\t\tconst currentActiveElement = (this.rootElement.getRootNode() as Document | ShadowRoot).activeElement;\r\n\r\n\t\tif (event.shiftKey && currentActiveElement === firstElement) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tlastElement.focus();\r\n\t\t} else if (!event.shiftKey && document.activeElement === lastElement) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tfirstElement.focus();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Creates a focus trap instance for the given element\r\n * @param options Configuration options for the focus trap\r\n * @returns A new FocusTrap instance\r\n */\r\nexport function createFocusTrap(options: FocusTrapOptions): FocusTrap {\r\n\treturn new FocusTrap(options.rootElement, options.focusableSelector, options.autoFocus);\r\n}\r\n\r\n/**\r\n * Registers slot change handlers to update focus trap\r\n * @param focusTrap The focus trap instance\r\n * @param slots Array of slots to monitor for changes\r\n * @returns A function to cleanup the event listeners\r\n */\r\nexport function setupSlotChangeHandlers(focusTrap: FocusTrap, slots: HTMLSlotElement[]): () => void {\r\n\tconst cleanups = slots.filter(Boolean).map((slot) => {\r\n\t\tconst handler = () => focusTrap.update(slot);\r\n\t\tslot.addEventListener('slotchange', handler);\r\n\t\treturn () => slot.removeEventListener('slotchange', handler);\r\n\t});\r\n\treturn () => cleanups.forEach((cleanup) => cleanup());\r\n}\r\n\r\n/**\r\n *\r\n * ********************************\r\n * Focus Handling utility functions\r\n * ********************************\r\n *\r\n */\r\n\r\n/**\r\n * FocusableComponent interface defines the structure required for components\r\n * that can be focused\r\n */\r\nexport interface FocusableComponent {\r\n\thost: HTMLElement;\r\n\tdisabled?: boolean;\r\n\tinternalElement?: HTMLElement;\r\n\r\n\t// Optional method to be implemented by the component\r\n\tsetFocus?: () => Promise<void>;\r\n}\r\n\r\n/**\r\n * Creates focus handling functionality for OUI components\r\n *\r\n * @param component The component instance that implements FocusableComponent interface\r\n * @param internalElementGetter Function that returns the internal focusable element\r\n * @returns Object with focus handling methods\r\n */\r\nexport function createFocusHandler<T extends FocusableComponent>(\r\n\tcomponent: T,\r\n\tinternalElementGetter: () => HTMLElement | null | undefined\r\n) {\r\n\t// Handler function for focus events on the host element\r\n\tconst handleHostFocus = () => {\r\n\t\tconst internalEl = internalElementGetter();\r\n\t\tif (internalEl && !component.disabled) {\r\n\t\t\tinternalEl.focus();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Setup focus handling - call this in connectedCallback\r\n\t */\r\n\tconst setupFocusHandling = () => {\r\n\t\t// Add focus event listener to forward focus to internal element\r\n\t\tcomponent.host.addEventListener('focus', handleHostFocus);\r\n\t\t// Store original focus method\r\n\t\tconst originalFocus = component.host.focus;\r\n\t\tcomponent.host.focus = () => {\r\n\t\t\tconst internalEl = internalElementGetter();\r\n\t\t\tif (internalEl && !component.disabled) {\r\n\t\t\t\tinternalEl.focus();\r\n\t\t\t} else if (originalFocus) {\r\n\t\t\t\toriginalFocus.call(component.host);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * Clean up focus handling - call this in disconnectedCallback\r\n\t */\r\n\tconst cleanupFocusHandling = () => {\r\n\t\tcomponent.host.removeEventListener('focus', handleHostFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * Public method to focus the element - implement this as a @Method in the component\r\n\t * The name is setFocus() to avoid conflicts with the native focus() method\r\n\t */\r\n\tconst setFocus = async (): Promise<void> => {\r\n\t\tconst internalEl = internalElementGetter();\r\n\t\tif (internalEl && !component.disabled) {\r\n\t\t\tinternalEl.focus();\r\n\t\t}\r\n\t\treturn Promise.resolve();\r\n\t};\r\n\r\n\treturn {\r\n\t\thandleHostFocus,\r\n\t\tsetupFocusHandling,\r\n\t\tcleanupFocusHandling,\r\n\t\tsetFocus\r\n\t};\r\n}\r\n"]}