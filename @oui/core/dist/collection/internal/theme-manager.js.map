{"version":3,"file":"theme-manager.js","sourceRoot":"","sources":["../../src/internal/theme-manager.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * OUI Theme Manager\r\n *\r\n * Provides theme management functionality for OUI library.\r\n * Handles theme switching, persistence, and event emission.\r\n *\r\n * Usage:\r\n * ```typescript\r\n * import { ThemeManager } from '@oui/core';\r\n *\r\n * // Initialize theme manager\r\n * ThemeManager.initialize();\r\n *\r\n * // Switch themes\r\n * ThemeManager.setTheme('white-label');\r\n *\r\n * // Listen for theme changes\r\n * document.addEventListener('oui-theme-changed', (event) => {\r\n *   console.log('New theme:', event.detail.theme);\r\n * });\r\n * ```\r\n */\r\n\r\n/**\r\n * Available built-in theme names\r\n */\r\nexport type OuiThemeName = 'oui';\r\n\r\n/**\r\n * Theme change event detail\r\n */\r\nexport interface OuiThemeChangeEvent {\r\n\ttheme: OuiThemeName;\r\n\tpreviousTheme: OuiThemeName | null;\r\n}\r\n\r\n/**\r\n * Theme manager configuration options\r\n */\r\nexport interface ThemeManagerOptions {\r\n\t/** Default theme to use if no theme is set */\r\n\tdefaultTheme?: OuiThemeName;\r\n\t/** Storage key for theme persistence */\r\n\tstorageKey?: string;\r\n\t/** Whether to persist theme selection */\r\n\tpersist?: boolean;\r\n\t/** Target element to apply theme data attribute */\r\n\ttarget?: HTMLElement;\r\n}\r\n\r\n/**\r\n * Default configuration\r\n */\r\nconst DEFAULT_OPTIONS: Required<ThemeManagerOptions> = {\r\n\tdefaultTheme: 'oui',\r\n\tstorageKey: 'oui-theme',\r\n\tpersist: true,\r\n\ttarget: document.documentElement\r\n};\r\n\r\n/**\r\n * Theme Manager Class\r\n *\r\n * Manages theme state, persistence, and DOM updates for OUI component library.\r\n */\r\nclass OuiThemeManager {\r\n\tprivate currentTheme: OuiThemeName | null = null;\r\n\tprivate options: Required<ThemeManagerOptions>;\r\n\tprivate initialized = false;\r\n\r\n\tconstructor() {\r\n\t\tthis.options = { ...DEFAULT_OPTIONS };\r\n\t}\r\n\r\n\t/**\r\n\t * Initialize the theme manager\r\n\t * @param options - Configuration options\r\n\t */\r\n\tpublic initialize(options: ThemeManagerOptions = {}): void {\r\n\t\tif (this.initialized) {\r\n\t\t\tconsole.warn('OUI Theme Manager is already initialized');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.options = { ...DEFAULT_OPTIONS, ...options };\r\n\t\tthis.initialized = true;\r\n\r\n\t\t// Load persisted theme or use default\r\n\t\tconst persistedTheme = this.loadPersistedTheme();\r\n\t\tconst initialTheme = persistedTheme || this.options.defaultTheme;\r\n\r\n\t\tthis.setTheme(initialTheme, false); // Don't emit event on initialization\r\n\t}\r\n\r\n\t/**\r\n\t * Set the current theme\r\n\t * @param theme - Theme name to set\r\n\t * @param emitEvent - Whether to emit theme change event (default: true)\r\n\t */\r\n\tpublic setTheme(theme: OuiThemeName, emitEvent: boolean = true): void {\r\n\t\tif (!this.initialized) {\r\n\t\t\tthrow new Error('Theme Manager must be initialized before setting theme');\r\n\t\t}\r\n\r\n\t\tconst previousTheme = this.currentTheme;\r\n\r\n\t\t// Only proceed if theme is actually changing\r\n\t\tif (previousTheme === theme) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.currentTheme = theme;\r\n\r\n\t\t// Update DOM data attribute\r\n\t\tthis.updateDomAttribute(theme);\r\n\r\n\t\t// Persist theme if enabled\r\n\t\tif (this.options.persist) {\r\n\t\t\tthis.persistTheme(theme);\r\n\t\t}\r\n\r\n\t\t// Emit theme change event\r\n\t\tif (emitEvent) {\r\n\t\t\tthis.emitThemeChangeEvent(theme, previousTheme);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current theme\r\n\t * @returns Current theme name or null if not set\r\n\t */\r\n\tpublic getCurrentTheme(): OuiThemeName | null {\r\n\t\treturn this.currentTheme;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if theme manager is initialized\r\n\t * @returns True if initialized\r\n\t */\r\n\tpublic isInitialized(): boolean {\r\n\t\treturn this.initialized;\r\n\t}\r\n\r\n\t/**\r\n\t * Get available theme names\r\n\t * @returns Array of available theme names\r\n\t */\r\n\tpublic getAvailableThemes(): OuiThemeName[] {\r\n\t\treturn ['oui'];\r\n\t}\r\n\r\n\t/**\r\n\t * Reset to default theme\r\n\t */\r\n\tpublic resetToDefault(): void {\r\n\t\tthis.setTheme(this.options.defaultTheme);\r\n\t}\r\n\r\n\t/**\r\n\t * Clear persisted theme data\r\n\t */\r\n\tpublic clearPersistedTheme(): void {\r\n\t\tif (typeof Storage !== 'undefined') {\r\n\t\t\tlocalStorage.removeItem(this.options.storageKey);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Update the DOM data attribute for theme\r\n\t * @private\r\n\t */\r\n\tprivate updateDomAttribute(theme: OuiThemeName): void {\r\n\t\tconst target = this.options.target;\r\n\r\n\t\tif (!target) {\r\n\t\t\tconsole.warn('Theme Manager: No target element specified');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Set the data-oui-theme attribute\r\n\t\ttarget.setAttribute('data-oui-theme', theme);\r\n\t}\r\n\r\n\t/**\r\n\t * Persist theme to localStorage\r\n\t * @private\r\n\t */\r\n\tprivate persistTheme(theme: OuiThemeName): void {\r\n\t\tif (typeof Storage !== 'undefined') {\r\n\t\t\ttry {\r\n\t\t\t\tlocalStorage.setItem(this.options.storageKey, theme);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.warn('Theme Manager: Failed to persist theme', error);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Load persisted theme from localStorage\r\n\t * @private\r\n\t */\r\n\tprivate loadPersistedTheme(): OuiThemeName | null {\r\n\t\tif (typeof Storage !== 'undefined') {\r\n\t\t\ttry {\r\n\t\t\t\tconst persisted = localStorage.getItem(this.options.storageKey);\r\n\t\t\t\tif (persisted && this.getAvailableThemes().includes(persisted as OuiThemeName)) {\r\n\t\t\t\t\treturn persisted as OuiThemeName;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.warn('Theme Manager: Failed to load persisted theme', error);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Emit custom theme change event\r\n\t * @private\r\n\t */\r\n\tprivate emitThemeChangeEvent(theme: OuiThemeName, previousTheme: OuiThemeName | null): void {\r\n\t\tconst eventDetail: OuiThemeChangeEvent = {\r\n\t\t\ttheme,\r\n\t\t\tpreviousTheme\r\n\t\t};\r\n\r\n\t\tconst event = new CustomEvent('oui-theme-changed', {\r\n\t\t\tdetail: eventDetail,\r\n\t\t\tbubbles: true,\r\n\t\t\tcancelable: false\r\n\t\t});\r\n\r\n\t\t// Emit on both document and target element for flexibility\r\n\t\tdocument.dispatchEvent(event);\r\n\r\n\t\tif (this.options.target && this.options.target !== document.documentElement) {\r\n\t\t\tthis.options.target.dispatchEvent(event);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Singleton instance of the theme manager\r\n */\r\nexport const ThemeManager = new OuiThemeManager();\r\n\r\n/**\r\n * Auto-initialize theme manager\r\n * This ensures OUI theme is applied by default.\r\n */\r\nfunction autoInitializeThemeManager(): void {\r\n\t// Check if already manually initialized\r\n\tif (ThemeManager.isInitialized()) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Initialize with default OUI theme\r\n\ttry {\r\n\t\tThemeManager.initialize({\r\n\t\t\tdefaultTheme: 'oui',\r\n\t\t\tpersist: true,\r\n\t\t\tstorageKey: 'oui-theme'\r\n\t\t});\r\n\t} catch (error) {\r\n\t\t// Fail - theme manager may be initialized in a context where DOM is not available\r\n\t\tconsole.warn('OUI Theme Manager: Auto-initialization deferred', error);\r\n\t}\r\n}\r\n\r\n// Auto-initialize immediately if DOM is ready, otherwise wait for DOMContentLoaded\r\nif (typeof document !== 'undefined') {\r\n\tif (document.readyState === 'loading') {\r\n\t\t// DOM is still loading, wait for it\r\n\t\tdocument.addEventListener('DOMContentLoaded', autoInitializeThemeManager, { once: true });\r\n\t} else {\r\n\t\t// DOM is already ready, initialize immediately\r\n\t\tautoInitializeThemeManager();\r\n\t}\r\n} else {\r\n\t// Not in a browser environment\r\n}\r\n\r\n/**\r\n * Declare global event type for TypeScript\r\n */\r\ndeclare global {\r\n\tinterface DocumentEventMap {\r\n\t\t'oui-theme-changed': CustomEvent<OuiThemeChangeEvent>;\r\n\t}\r\n\r\n\tinterface HTMLElementEventMap {\r\n\t\t'oui-theme-changed': CustomEvent<OuiThemeChangeEvent>;\r\n\t}\r\n}\r\n"]}