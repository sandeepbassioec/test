{"version":3,"file":"o-menu.js","sourceRoot":"","sources":["../../../src/components/o-menu/o-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { EventEmitter } from '@stencil/core';\r\nimport { Component, Element, Event, h, Method } from '@stencil/core';\r\nimport type { OMenuItem } from '../o-menu-item/o-menu-item';\r\n\r\nexport interface OMenuSelectPayload {\r\n\titem: OMenuItem;\r\n}\r\n\r\n@Component({\r\n\ttag: 'o-menu',\r\n\tstyleUrl: 'o-menu.scss',\r\n\tshadow: true\r\n})\r\nexport class OMenu {\r\n\tprivate menu: HTMLSlotElement;\r\n\tprivate menuItems: OMenuItem[];\r\n\tprivate activeItem: OMenuItem;\r\n\t@Element() host!: HTMLOMenuElement;\r\n\r\n\t@Event() oMenuSelect!: EventEmitter<OMenuSelectPayload>;\r\n\r\n\t/* istanbul ignore next */\r\n\thandleClick = (event: MouseEvent) => {\r\n\t\tconst composedPath = event.composedPath();\r\n\t\tconst target = composedPath.find((el: Element) => el?.getAttribute?.('role') === 'menuitem');\r\n\r\n\t\tif (!target) return;\r\n\r\n\t\t(target as HTMLElement).blur();\r\n\t\tthis.oMenuSelect.emit({ item: target as unknown as OMenuItem });\r\n\t};\r\n\r\n\t/* istanbul ignore next */\r\n\thandleMouseDown = (event: MouseEvent) => {\r\n\t\tconst target = event.target as HTMLElement;\r\n\r\n\t\tif (this.isMenuItem(target)) this.setCurrentItem(target as unknown as OMenuItem);\r\n\t};\r\n\r\n\t/* istanbul ignore next */\r\n\thandleKeyDown = (event: KeyboardEvent) => {\r\n\t\tif (event.key === 'Enter' || event.key === ' ') {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\r\n\t\t\tif (this.activeItem.index === 0)\r\n\t\t\t\t(this.activeItem as unknown as HTMLElement).shadowRoot.querySelector('div').click();\r\n\t\t} else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(event.key)) {\r\n\t\t\tlet index = this.activeItem ? this.menuItems.indexOf(this.activeItem) : 0;\r\n\r\n\t\t\tif (this.menuItems.length > 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopPropagation();\r\n\r\n\t\t\t\tif (event.key === 'ArrowDown') {\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t} else if (event.key === 'ArrowUp') {\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t} else if (event.key === 'Home') {\r\n\t\t\t\t\tindex = 0;\r\n\t\t\t\t} else if (event.key === 'End') {\r\n\t\t\t\t\tindex = this.menuItems.length - 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index < 0) {\r\n\t\t\t\t\tindex = this.menuItems.length - 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (index > this.menuItems.length - 1) {\r\n\t\t\t\t\tindex = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setCurrentItem(this.menuItems[index]);\r\n\t\t\t\tthis.menuItems[index].setFocus();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tasync handleSlotChange() {\r\n\t\tconst items = await this.getMenuItems();\r\n\t\tthis.menuItems = await this.getMenuItems();\r\n\r\n\t\tif (items.length > 0) this.setCurrentItem(items[0]);\r\n\t}\r\n\r\n\tisMenuItem(item: HTMLElement) {\r\n\t\treturn item.tagName.toLowerCase() === 'o-menu-item';\r\n\t}\r\n\r\n\tasync getCurrentItem() {\r\n\t\treturn (await this.getMenuItems()).find((i) => i.index === 0);\r\n\t}\r\n\r\n\t@Method()\r\n\tasync setCurrentItem(item: OMenuItem) {\r\n\t\tthis.activeItem = item;\r\n\t\tconst items = await this.getMenuItems();\r\n\r\n\t\titems.forEach((i) => {\r\n\t\t\ti.index = i === item ? 0 : -1;\r\n\t\t});\r\n\t}\r\n\r\n\t@Method()\r\n\tasync getMenuItems() {\r\n\t\treturn [...this.menu.assignedElements?.({ flatten: true })].filter((el: HTMLElement) => {\r\n\t\t\tif (el.inert || !this.isMenuItem(el)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}) as unknown as OMenuItem[];\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\trole=\"menu\"\r\n\t\t\t\tonClick={this.handleClick}\r\n\t\t\t\tonMouseDown={this.handleMouseDown}\r\n\t\t\t\tonKeyDown={this.handleKeyDown}\r\n\t\t\t\tclass=\"bg-background-default border-width-sm border-border-default rounded-radius-lg py-2\"\r\n\t\t\t>\r\n\t\t\t\t<slot ref={(el) => (this.menu = el as HTMLSlotElement)} onSlotchange={() => this.handleSlotChange()}></slot>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n"]}