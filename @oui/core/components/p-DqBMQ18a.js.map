{"file":"p-DqBMQ18a.js","mappings":"AAAM,SAAU,UAAU,CAAC,OAAoB,EAAA;IAC9C,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC;AACpC,IAAA,IAAI,IAAI,IAAI,IAAI,EAAE;;;;QAIjB,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC;AACnD,QAAA,UAAU,CAAC,IAAI,GAAG,QAAQ;AAC1B,QAAA,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM;AACjC,QAAA,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC;QAC5B,UAAU,CAAC,KAAK,EAAE;QAClB,UAAU,CAAC,MAAM,EAAE;;AAErB;;ACbA;;;;;;;;AAQG;AAWH;AACA,MAAM,0BAA0B,GAC/B,oMAAoM;MAExL,SAAS,CAAA;AAMrB,IAAA,WAAA,CACS,WAAwB,EACxB,iBAAA,GAA4B,0BAA0B,EACtD,YAAqB,KAAK,EAAA;QAF1B,IAAW,CAAA,WAAA,GAAX,WAAW;QACX,IAAiB,CAAA,iBAAA,GAAjB,iBAAiB;QACjB,IAAS,CAAA,SAAA,GAAT,SAAS;QARV,IAAiB,CAAA,iBAAA,GAAkB,EAAE;QACrC,IAAQ,CAAA,QAAA,GAAY,KAAK;QACzB,IAAc,CAAA,cAAA,GAA0B,IAAI;QAC5C,IAAgB,CAAA,gBAAA,GAA4B,IAAI;QAOvD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC;QAClD,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,CAAC;QACxE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC;QAE1C,IAAI,iBAAiB,EAAE;YACtB,IAAI,CAAC,iBAAiB,GAAG,CAAA,EAAG,0BAA0B,CAAK,EAAA,EAAA,iBAAiB,EAAE;;aACxE;AACN,YAAA,IAAI,CAAC,iBAAiB,GAAG,0BAA0B;;;AAIrD;;AAEG;IACI,QAAQ,GAAA;QACd,IAAI,IAAI,CAAC,QAAQ;YAAE;AACnB,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI;QACpB,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC;QACxD,IAAI,CAAC,wBAAwB,EAAE;QAC/B,IAAI,CAAC,cAAc,EAAE;QACrB,UAAU,CAAC,MAAK;YACf,IAAI,CAAC,wBAAwB,EAAE;AAE/B,YAAA,IAAI,IAAI,CAAC,SAAS,EAAE;AACnB,gBAAA,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE;oBAClC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE;;;iBAE5B;;AAEN,gBAAA,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE;;SAEzB,EAAE,GAAG,CAAC;;AAGR;;AAEG;IACI,UAAU,GAAA;QAChB,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE;AACpB,QAAA,IAAI,CAAC,QAAQ,GAAG,KAAK;QACrB,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC;QAC3D,IAAI,CAAC,gBAAgB,EAAE;AACvB,QAAA,IAAI,CAAC,iBAAiB,GAAG,EAAE;;AAG5B;;AAEG;IACK,cAAc,GAAA;AACrB,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,gBAAgB,CAAC,MAAM,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,wBAAwB,EAAE,CAAC;AACpG,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,cAAc,CAAC,MAAM,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,wBAAwB,EAAE,CAAC;AAEhG,QAAA,IAAI,IAAI,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE;AAC/C,gBAAA,SAAS,EAAE,IAAI;AACf,gBAAA,OAAO,EAAE,IAAI;AACb,gBAAA,UAAU,EAAE,IAAI;gBAChB,eAAe,EAAE,CAAC,UAAU,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO;AAC3D,aAAA,CAAC;YACF,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC;;;AAI/C;;AAEG;IACK,gBAAgB,GAAA;;AACvB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,gBAAgB,MAAE,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,MAAA,GAAA,EAAA,CAAA,UAAU,EAAE;AACnC,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI;AAC5B,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,cAAc,MAAE,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,MAAA,GAAA,EAAA,CAAA,UAAU,EAAE;AACjC,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI;;AAG3B;;;AAGG;AACI,IAAA,MAAM,CAAC,IAAsB,EAAA;AACnC,QAAA,IAAI,IAAI,CAAC,QAAQ,EAAE;YAClB,IAAI,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,wBAAwB,EAAE;;;AAI9G;;AAEG;IACK,wBAAwB,GAAA;AAC/B,QAAA,IAAI,CAAC,iBAAiB,GAAG,EAAE;QAC3B,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE;AACvB,QAAA,IAAI;YACH,MAAM,KAAK,GAAG,CAAC,QAAgB,EAAE,IAAa,KAC7C,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAkB;;AAGpF,YAAA,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,iCAAiC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE;gBACpG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC;;AAG9C,YAAA,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AAE/E,YAAA,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,KAAI;AAC1D,gBAAA,IAAI,CAAC,gBAAgB,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,KAAI;AACvD,oBAAA,IAAI,EAAE,YAAY,WAAW,EAAE;AAC9B,wBAAA,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE;AAC7D,4BAAA,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,CAAC;;AAEhC,wBAAA,IAAI,EAAE,CAAC,gBAAgB,EAAE;AACxB,4BAAA,IAAI;AACH,gCAAA,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;;4BAChE,OAAO,GAAG,EAAE;AACb,gCAAA,OAAO,CAAC,KAAK,CAAC,2CAA2C,EAAE,GAAG,CAAC;;;;AAInE,iBAAC,CAAC;AACH,aAAC,CAAC;;AAGF,YAAA,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACpE,IAAI,CAAC,qBAAqB,EAAE;;QAC3B,OAAO,GAAG,EAAE;AACb,YAAA,OAAO,CAAC,KAAK,CAAC,oCAAoC,EAAE,GAAG,CAAC;;;AAI1D;;AAEG;IACK,qBAAqB,GAAA;QAC5B,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAI;AACpC,YAAA,MAAM,SAAS,GAAG,CAAC,CAAC,QAAQ;AAC5B,YAAA,MAAM,SAAS,GAAG,CAAC,CAAC,QAAQ;AAC5B,YAAA,OAAO,SAAS,GAAG,CAAC,IAAI,SAAS,GAAG,CAAC,GAAG,SAAS,GAAG,SAAS,GAAG,SAAS,GAAG,CAAC,GAAG,EAAE,GAAG,SAAS,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC;AAC3G,SAAC,CAAC;;AAGH;;AAEG;AACK,IAAA,SAAS,CAAC,OAAoB,EAAA;AACrC,QAAA,IAAI,CAAC,OAAO;AAAE,YAAA,OAAO,KAAK;AAC1B,QAAA,IAAI;AACH,YAAA,MAAM,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC;YAChE,QACC,CAAC,OAAO,CAAC,WAAW,GAAG,CAAC,IAAI,OAAO,CAAC,YAAY,GAAG,CAAC,IAAI,OAAO,CAAC,cAAc,EAAE,CAAC,MAAM,GAAG,CAAC;AAC3F,gBAAA,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,MAAM;;QAElB,OAAO,IAAI,EAAE;AACd,YAAA,OAAO,KAAK;;;AAId;;AAEG;AACK,IAAA,oBAAoB,CAAC,QAAmB,EAAA;AAC/C,QAAA,IAAI;YACH,MAAM,WAAW,GAAkB,EAAE;AACrC,YAAA,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,KAAI;AAC5B,gBAAA,IAAI,OAAO,YAAY,WAAW,EAAE;AACnC,oBAAA,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE;AACvE,wBAAA,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC;;AAE1B,oBAAA,IAAI,OAAO,CAAC,gBAAgB,EAAE;AAC7B,wBAAA,IAAI;4BACH,MAAM,cAAc,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,MAAM,CACzF,IAAI,CAAC,SAAS,CACG;AAClB,4BAAA,WAAW,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC;;wBAClC,OAAO,GAAG,EAAE;AACb,4BAAA,OAAO,CAAC,KAAK,CAAC,0CAA0C,EAAE,GAAG,CAAC;;;;AAIlE,aAAC,CAAC;YACF,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,iBAAiB,EAAE,GAAG,WAAW,CAAC,CAAC,CAAC;YACzF,IAAI,CAAC,qBAAqB,EAAE;;QAC3B,OAAO,GAAG,EAAE;AACb,YAAA,OAAO,CAAC,KAAK,CAAC,gCAAgC,EAAE,GAAG,CAAC;;;AAItD;;AAEG;AACK,IAAA,aAAa,CAAC,KAAoB,EAAA;QACzC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK;YAAE;QAC3C,IAAI,CAAC,wBAAwB,EAAE;QAC/B,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;YACtC,KAAK,CAAC,cAAc,EAAE;YACtB;;QAED,MAAM,CAAC,YAAY,EAAE,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,EAAE,CAAE,CAAC;QAC/F,MAAM,oBAAoB,GAAI,IAAI,CAAC,WAAW,CAAC,WAAW,EAA4B,CAAC,aAAa;QAEpG,IAAI,KAAK,CAAC,QAAQ,IAAI,oBAAoB,KAAK,YAAY,EAAE;YAC5D,KAAK,CAAC,cAAc,EAAE;YACtB,WAAW,CAAC,KAAK,EAAE;;aACb,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,QAAQ,CAAC,aAAa,KAAK,WAAW,EAAE;YACrE,KAAK,CAAC,cAAc,EAAE;YACtB,YAAY,CAAC,KAAK,EAAE;;;AAGtB;AAED;;;;AAIG;AACG,SAAU,eAAe,CAAC,OAAyB,EAAA;AACxD,IAAA,OAAO,IAAI,SAAS,CAAC,OAAO,CAAC,WAAW,EAAE,OAAO,CAAC,iBAAiB,EAAE,OAAO,CAAC,SAAS,CAAC;AACxF;AAEA;;;;;AAKG;AACa,SAAA,uBAAuB,CAAC,SAAoB,EAAE,KAAwB,EAAA;AACrF,IAAA,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,KAAI;QACnD,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC;AAC5C,QAAA,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,OAAO,CAAC;QAC5C,OAAO,MAAM,IAAI,CAAC,mBAAmB,CAAC,YAAY,EAAE,OAAO,CAAC;AAC7D,KAAC,CAAC;AACF,IAAA,OAAO,MAAM,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,KAAK,OAAO,EAAE,CAAC;AACtD;AAuBA;;;;;;AAMG;AACa,SAAA,kBAAkB,CACjC,SAAY,EACZ,qBAA2D,EAAA;;IAG3D,MAAM,eAAe,GAAG,MAAK;AAC5B,QAAA,MAAM,UAAU,GAAG,qBAAqB,EAAE;AAC1C,QAAA,IAAI,UAAU,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;YACtC,UAAU,CAAC,KAAK,EAAE;;AAEpB,KAAC;AAED;;AAEG;IACH,MAAM,kBAAkB,GAAG,MAAK;;QAE/B,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,eAAe,CAAC;;AAEzD,QAAA,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAAC,KAAK;AAC1C,QAAA,SAAS,CAAC,IAAI,CAAC,KAAK,GAAG,MAAK;AAC3B,YAAA,MAAM,UAAU,GAAG,qBAAqB,EAAE;AAC1C,YAAA,IAAI,UAAU,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;gBACtC,UAAU,CAAC,KAAK,EAAE;;iBACZ,IAAI,aAAa,EAAE;AACzB,gBAAA,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;;AAEpC,SAAC;AACF,KAAC;AAED;;AAEG;IACH,MAAM,oBAAoB,GAAG,MAAK;QACjC,SAAS,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,eAAe,CAAC;AAC7D,KAAC;AAED;;;AAGG;AACH,IAAA,MAAM,QAAQ,GAAG,YAA0B;AAC1C,QAAA,MAAM,UAAU,GAAG,qBAAqB,EAAE;AAC1C,QAAA,IAAI,UAAU,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;YACtC,UAAU,CAAC,KAAK,EAAE;;AAEnB,QAAA,OAAO,OAAO,CAAC,OAAO,EAAE;AACzB,KAAC;IAED,OAAO;QACN,eAAe;QACf,kBAAkB;QAClB,oBAAoB;QACpB;KACA;AACF;;;;","names":[],"sources":["src/internal/forms.ts","src/internal/a11y.ts"],"sourcesContent":["export function submitForm(element: HTMLElement) {\r\n\tconst form = element.closest('form');\r\n\tif (form != null) {\r\n\t\t// Calling form.submit() would bypass the submit event and constraint validation.\r\n\t\t// To prevent this, we inject a native submit button into the form, \"click\" it,\r\n\t\t// then remove it to simulate a standard form submission.\r\n\t\tconst fakeButton = document.createElement('button');\r\n\t\tfakeButton.type = 'submit';\r\n\t\tfakeButton.style.display = 'none';\r\n\t\tform.appendChild(fakeButton);\r\n\t\tfakeButton.click();\r\n\t\tfakeButton.remove();\r\n\t}\r\n}\r\n","/**\r\n *\r\n * ******************************************************************\r\n * Utility for managing focus trapping within OUI components.\r\n * This allows components like ODrawer, ODialogs, etc. to trap focus\r\n * within their boundaries for improved accessibility.\r\n * ******************************************************************\r\n *\r\n */\r\n\r\nexport interface FocusTrapOptions {\r\n\t/** The root element of the component where focus will be trapped */\r\n\trootElement: HTMLElement;\r\n\t/** The selector for additional focusable elements */\r\n\tfocusableSelector?: string;\r\n\t/** Whether to initially focus the first element when trap is activated */\r\n\tautoFocus?: boolean;\r\n}\r\n\r\n// Define default focusable selector\r\nconst DEFAULT_FOCUSABLE_SELECTOR =\r\n\t'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"]), o-button:not([disabled]), o-icon-button:not([disabled])';\r\n\r\nexport class FocusTrap {\r\n\tprivate focusableElements: HTMLElement[] = [];\r\n\tprivate isActive: boolean = false;\r\n\tprivate resizeObserver: ResizeObserver | null = null;\r\n\tprivate mutationObserver: MutationObserver | null = null;\r\n\r\n\tconstructor(\r\n\t\tprivate rootElement: HTMLElement,\r\n\t\tprivate focusableSelector: string = DEFAULT_FOCUSABLE_SELECTOR,\r\n\t\tprivate autoFocus: boolean = false\r\n\t) {\r\n\t\tthis.handleKeyDown = this.handleKeyDown.bind(this);\r\n\t\tthis.collectFocusableElements = this.collectFocusableElements.bind(this);\r\n\t\tthis.isVisible = this.isVisible.bind(this);\r\n\r\n\t\tif (focusableSelector) {\r\n\t\t\tthis.focusableSelector = `${DEFAULT_FOCUSABLE_SELECTOR}, ${focusableSelector}`;\r\n\t\t} else {\r\n\t\t\tthis.focusableSelector = DEFAULT_FOCUSABLE_SELECTOR;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Activates the focus trap\r\n\t */\r\n\tpublic activate(): void {\r\n\t\tif (this.isActive) return;\r\n\t\tthis.isActive = true;\r\n\t\tdocument.addEventListener('keydown', this.handleKeyDown);\r\n\t\tthis.collectFocusableElements();\r\n\t\tthis.setupObservers();\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.collectFocusableElements();\r\n\r\n\t\t\tif (this.autoFocus) {\r\n\t\t\t\tif (this.focusableElements.length) {\r\n\t\t\t\t\tthis.focusableElements[0].focus();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Focus the root element if autoFocus is false\r\n\t\t\t\tthis.rootElement.focus();\r\n\t\t\t}\r\n\t\t}, 150);\r\n\t}\r\n\r\n\t/**\r\n\t * Deactivates the focus trap\r\n\t */\r\n\tpublic deactivate(): void {\r\n\t\tif (!this.isActive) return;\r\n\t\tthis.isActive = false;\r\n\t\tdocument.removeEventListener('keydown', this.handleKeyDown);\r\n\t\tthis.cleanupObservers();\r\n\t\tthis.focusableElements = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Set up observers to track DOM changes\r\n\t */\r\n\tprivate setupObservers(): void {\r\n\t\tthis.mutationObserver = new MutationObserver(() => this.isActive && this.collectFocusableElements());\r\n\t\tthis.resizeObserver = new ResizeObserver(() => this.isActive && this.collectFocusableElements());\r\n\r\n\t\tif (this.rootElement) {\r\n\t\t\tthis.mutationObserver.observe(this.rootElement, {\r\n\t\t\t\tchildList: true,\r\n\t\t\t\tsubtree: true,\r\n\t\t\t\tattributes: true,\r\n\t\t\t\tattributeFilter: ['disabled', 'tabindex', 'hidden', 'style']\r\n\t\t\t});\r\n\t\t\tthis.resizeObserver.observe(this.rootElement);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clean up observers\r\n\t */\r\n\tprivate cleanupObservers(): void {\r\n\t\tthis.mutationObserver?.disconnect();\r\n\t\tthis.mutationObserver = null;\r\n\t\tthis.resizeObserver?.disconnect();\r\n\t\tthis.resizeObserver = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the list of focusable elements\r\n\t * @param slot Optional slot that changed, to only process specific elements\r\n\t */\r\n\tpublic update(slot?: HTMLSlotElement): void {\r\n\t\tif (this.isActive) {\r\n\t\t\tslot ? this.addFocusableElements(slot.assignedElements({ flatten: true })) : this.collectFocusableElements();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Collects all focusable elements within the component\r\n\t */\r\n\tprivate collectFocusableElements(): void {\r\n\t\tthis.focusableElements = [];\r\n\t\tif (!this.rootElement) return;\r\n\t\ttry {\r\n\t\t\tconst query = (selector: string, root: Element): HTMLElement[] =>\r\n\t\t\t\tArray.from(root.querySelectorAll(selector)).filter(this.isVisible) as HTMLElement[];\r\n\r\n\t\t\t// Check if the root element itself is focusable\r\n\t\t\tif (this.rootElement.matches('[tabindex]:not([tabindex=\"-1\"])') && this.isVisible(this.rootElement)) {\r\n\t\t\t\tthis.focusableElements.push(this.rootElement);\r\n\t\t\t}\r\n\r\n\t\t\tthis.focusableElements.push(...query(this.focusableSelector, this.rootElement));\r\n\r\n\t\t\tthis.rootElement.querySelectorAll('slot').forEach((slot) => {\r\n\t\t\t\tslot.assignedElements({ flatten: true }).forEach((el) => {\r\n\t\t\t\t\tif (el instanceof HTMLElement) {\r\n\t\t\t\t\t\tif (el.matches(this.focusableSelector) && this.isVisible(el)) {\r\n\t\t\t\t\t\t\tthis.focusableElements.push(el);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (el.querySelectorAll) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tthis.focusableElements.push(...query(this.focusableSelector, el));\r\n\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\tconsole.error('Error querying nested focusable elements:', err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Remove duplicates and sort\r\n\t\t\tthis.focusableElements = Array.from(new Set(this.focusableElements));\r\n\t\t\tthis.sortFocusableElements();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Error in collectFocusableElements:', err);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sort focusable elements by tabindex\r\n\t */\r\n\tprivate sortFocusableElements(): void {\r\n\t\tthis.focusableElements.sort((a, b) => {\r\n\t\t\tconst aTabIndex = a.tabIndex;\r\n\t\t\tconst bTabIndex = b.tabIndex;\r\n\t\t\treturn aTabIndex > 0 && bTabIndex > 0 ? aTabIndex - bTabIndex : aTabIndex > 0 ? -1 : bTabIndex > 0 ? 1 : 0;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Check if an element is visible\r\n\t */\r\n\tprivate isVisible(element: HTMLElement): boolean {\r\n\t\tif (!element) return false;\r\n\t\ttry {\r\n\t\t\tconst { visibility, display } = window.getComputedStyle(element);\r\n\t\t\treturn (\r\n\t\t\t\t(element.offsetWidth > 0 || element.offsetHeight > 0 || element.getClientRects().length > 0) &&\r\n\t\t\t\tvisibility !== 'hidden' &&\r\n\t\t\t\tdisplay !== 'none'\r\n\t\t\t);\r\n\t\t} catch (_err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method to add focusable elements from a node list\r\n\t */\r\n\tprivate addFocusableElements(elements: Element[]): void {\r\n\t\ttry {\r\n\t\t\tconst newElements: HTMLElement[] = [];\r\n\t\t\telements.forEach((element) => {\r\n\t\t\t\tif (element instanceof HTMLElement) {\r\n\t\t\t\t\tif (element.matches(this.focusableSelector) && this.isVisible(element)) {\r\n\t\t\t\t\t\tnewElements.push(element);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (element.querySelectorAll) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst childFocusable = Array.from(element.querySelectorAll(this.focusableSelector)).filter(\r\n\t\t\t\t\t\t\t\tthis.isVisible\r\n\t\t\t\t\t\t\t) as HTMLElement[];\r\n\t\t\t\t\t\t\tnewElements.push(...childFocusable);\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tconsole.error('Error querying child focusable elements:', err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.focusableElements = Array.from(new Set([...this.focusableElements, ...newElements]));\r\n\t\t\tthis.sortFocusableElements();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Error in addFocusableElements:', err);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles Tab key events to trap focus\r\n\t */\r\n\tprivate handleKeyDown(event: KeyboardEvent): void {\r\n\t\tif (!this.isActive || event.key !== 'Tab') return;\r\n\t\tthis.collectFocusableElements();\r\n\t\tif (this.focusableElements.length < 2) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst [firstElement, lastElement] = [this.focusableElements[0], this.focusableElements.at(-1)!];\r\n\t\tconst currentActiveElement = (this.rootElement.getRootNode() as Document | ShadowRoot).activeElement;\r\n\r\n\t\tif (event.shiftKey && currentActiveElement === firstElement) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tlastElement.focus();\r\n\t\t} else if (!event.shiftKey && document.activeElement === lastElement) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tfirstElement.focus();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Creates a focus trap instance for the given element\r\n * @param options Configuration options for the focus trap\r\n * @returns A new FocusTrap instance\r\n */\r\nexport function createFocusTrap(options: FocusTrapOptions): FocusTrap {\r\n\treturn new FocusTrap(options.rootElement, options.focusableSelector, options.autoFocus);\r\n}\r\n\r\n/**\r\n * Registers slot change handlers to update focus trap\r\n * @param focusTrap The focus trap instance\r\n * @param slots Array of slots to monitor for changes\r\n * @returns A function to cleanup the event listeners\r\n */\r\nexport function setupSlotChangeHandlers(focusTrap: FocusTrap, slots: HTMLSlotElement[]): () => void {\r\n\tconst cleanups = slots.filter(Boolean).map((slot) => {\r\n\t\tconst handler = () => focusTrap.update(slot);\r\n\t\tslot.addEventListener('slotchange', handler);\r\n\t\treturn () => slot.removeEventListener('slotchange', handler);\r\n\t});\r\n\treturn () => cleanups.forEach((cleanup) => cleanup());\r\n}\r\n\r\n/**\r\n *\r\n * ********************************\r\n * Focus Handling utility functions\r\n * ********************************\r\n *\r\n */\r\n\r\n/**\r\n * FocusableComponent interface defines the structure required for components\r\n * that can be focused\r\n */\r\nexport interface FocusableComponent {\r\n\thost: HTMLElement;\r\n\tdisabled?: boolean;\r\n\tinternalElement?: HTMLElement;\r\n\r\n\t// Optional method to be implemented by the component\r\n\tsetFocus?: () => Promise<void>;\r\n}\r\n\r\n/**\r\n * Creates focus handling functionality for OUI components\r\n *\r\n * @param component The component instance that implements FocusableComponent interface\r\n * @param internalElementGetter Function that returns the internal focusable element\r\n * @returns Object with focus handling methods\r\n */\r\nexport function createFocusHandler<T extends FocusableComponent>(\r\n\tcomponent: T,\r\n\tinternalElementGetter: () => HTMLElement | null | undefined\r\n) {\r\n\t// Handler function for focus events on the host element\r\n\tconst handleHostFocus = () => {\r\n\t\tconst internalEl = internalElementGetter();\r\n\t\tif (internalEl && !component.disabled) {\r\n\t\t\tinternalEl.focus();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Setup focus handling - call this in connectedCallback\r\n\t */\r\n\tconst setupFocusHandling = () => {\r\n\t\t// Add focus event listener to forward focus to internal element\r\n\t\tcomponent.host.addEventListener('focus', handleHostFocus);\r\n\t\t// Store original focus method\r\n\t\tconst originalFocus = component.host.focus;\r\n\t\tcomponent.host.focus = () => {\r\n\t\t\tconst internalEl = internalElementGetter();\r\n\t\t\tif (internalEl && !component.disabled) {\r\n\t\t\t\tinternalEl.focus();\r\n\t\t\t} else if (originalFocus) {\r\n\t\t\t\toriginalFocus.call(component.host);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * Clean up focus handling - call this in disconnectedCallback\r\n\t */\r\n\tconst cleanupFocusHandling = () => {\r\n\t\tcomponent.host.removeEventListener('focus', handleHostFocus);\r\n\t};\r\n\r\n\t/**\r\n\t * Public method to focus the element - implement this as a @Method in the component\r\n\t * The name is setFocus() to avoid conflicts with the native focus() method\r\n\t */\r\n\tconst setFocus = async (): Promise<void> => {\r\n\t\tconst internalEl = internalElementGetter();\r\n\t\tif (internalEl && !component.disabled) {\r\n\t\t\tinternalEl.focus();\r\n\t\t}\r\n\t\treturn Promise.resolve();\r\n\t};\r\n\r\n\treturn {\r\n\t\thandleHostFocus,\r\n\t\tsetupFocusHandling,\r\n\t\tcleanupFocusHandling,\r\n\t\tsetFocus\r\n\t};\r\n}\r\n"],"version":3}